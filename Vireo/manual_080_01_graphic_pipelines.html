<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="DoxyPress 2.0.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Vireo: Graphics Pipelines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxypress.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by DoxyPress -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vireo
      &#160;<span id="projectnumber">0.0</span>
   </div>
   <div id="projectbrief">Vireo 3D Rendering Hardware Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by DoxyPress 2.0.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Documentation</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('manual_080_01_graphic_pipelines.html',''); initResizable(); });
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
    <div class="title">Graphics Pipelines </div>
  </div>
  <div class="clear-floats"></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The graphics pipeline is the sequence of operations that take the vertices and textures of your meshes all the way to the pixels in the render targets.</p>
<p>The different stages of the pipeline operations are roughly the same in Vulkan and DirectX but sometime with different names :</p><ul>
<li><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Graphics_pipeline_basics/Introduction">Vulkan graphic pipeline</a></li>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/direct3d11/overviews-direct3d-11-graphics-pipeline">DirectX 12 graphic pipeline</a></li>
</ul>
<h2>Configuration of a graphic pipeline</h2>
<p>Creation of a graphic pipeline involve a lot of parameters. Most notable parameters are the format of the attachment (an attachment or render target is an image where the shaders will write), the color blending for each attachment, the format of the vertices, and the shaders.</p>
<p>The <a class="el" href="structvireo_1_1GraphicPipelineConfiguration.html">GraphicPipelineConfiguration</a> structure is used to specify all the creation parameter.</p>
<h3>Resources parameters</h3>
<ul>
<li><code>resources</code>: the <a class="el" href="manual_040_04_pipeline_resources.html">resources</a> for the shaders created with <a class="el" href="classvireo_1_1Vireo.html#a1a2694c5cce82ee9d6ee3a17e454f650">vireo::Vireo::createPipelineResources</a></li>
<li><code>vertexInputLayout</code> : description of the format of a vertex created with created with <a class="el" href="classvireo_1_1Vireo.html#a7261cac5cb82702c34b49cffc08c8f74">vireo::Vireo::createVertexLayout</a> from a <a class="el" href="structvireo_1_1VertexAttributeDesc.html">vireo::VertexAttributeDesc</a> description</li>
</ul>
<p>For <a class="el" href="classvireo_1_1Vireo.html#a7261cac5cb82702c34b49cffc08c8f74">vireo::Vireo::createVertexLayout</a> each field of the vertex data structure must be described with the following parameters :</p><ul>
<li><code>binding</code> : Binding name which this attribute takes its data from for the HLSL style binding. For the Vulkan style the binding number will be calculated from the index of the field.</li>
<li><code>format</code> : <a class="el" href="namespacevireo.html#ae8bee0afbe765c96044673fb0a0f9691">Type for data</a></li>
<li><code>offset</code> : Byte offset of this attribute relative to the start of an element in the data structure.</li>
</ul>
<p>For example, if the vertex structure is, for each vertex : </p><div class="fragment"><div class="line"> <span class="keyword">struct </span>Vertex {</div>
<div class="line">    glm::vec3 position;</div>
<div class="line">    glm::vec3 normal;</div>
<div class="line">    glm::vec2 uv;</div>
<div class="line">    glm::vec3 tangent;</div>
<div class="line">};</div>
</div><!-- end fragment -->
<p>The input layout description will be the following array : </p><div class="fragment"><div class="line"><span class="keyword">const</span> std::vector&lt;vireo::VertexAttributeDesc&gt; vertexAttributes{</div>
<div class="line">    {<span class="stringliteral">&quot;POSITION&quot;</span>, <a class="code" href="namespacevireo.html#ae8bee0afbe765c96044673fb0a0f9691ad05d603c5884ae9ccc392513becba305" title="Three signed floats. ">vireo::AttributeFormat::R32G32B32_FLOAT</a>, offsetof(Vertex, position) },  <span class="comment">// Binding #0</span></div>
<div class="line">    {<span class="stringliteral">&quot;NORMAL&quot;</span>,   <a class="code" href="namespacevireo.html#ae8bee0afbe765c96044673fb0a0f9691ad05d603c5884ae9ccc392513becba305" title="Three signed floats. ">vireo::AttributeFormat::R32G32B32_FLOAT</a>, offsetof(Vertex, normal)},     <span class="comment">// Binding #1</span></div>
<div class="line">    {<span class="stringliteral">&quot;UV&quot;</span>,       <a class="code" href="namespacevireo.html#ae8bee0afbe765c96044673fb0a0f9691a034e2a26f1b92822236e0095a5ca1848" title="Two signed floats. ">vireo::AttributeFormat::R32G32_FLOAT</a>,    offsetof(Vertex, uv)},         <span class="comment">// Binding #2</span></div>
<div class="line">    {<span class="stringliteral">&quot;TANGENT&quot;</span>,  <a class="code" href="namespacevireo.html#ae8bee0afbe765c96044673fb0a0f9691ad05d603c5884ae9ccc392513becba305" title="Three signed floats. ">vireo::AttributeFormat::R32G32B32_FLOAT</a>,   offsetof(Vertex, tangent)},  <span class="comment">// Binding #3</span></div>
<div class="line">};</div>
</div><!-- end fragment -->
<p>and the corresponding structure in the shader in the Slang shader language (<b>must</b> be in the same order) : </p><div class="fragment"><div class="line"><span class="keyword">struct </span>VertexInput {</div>
<div class="line">    float3 position : POSITION;</div>
<div class="line">    float3 normal   : NORMAL;</div>
<div class="line">    float2 uv       : UV;</div>
<div class="line">    float3 tangent  : TANGENT;</div>
<div class="line">};</div>
</div><!-- end fragment -->
<h3>Shader modules list</h3>
<ul>
<li><code>vertexShader</code>, <code>fragmentShader</code> : the <a class="el" href="manual_070_00_shaders.html">shader modules</a>. Must have at least a vertex shader.</li>
</ul>
<h3>Color attachment parameters</h3>
<ul>
<li><code>colorRenderFormats</code> : an array of <a class="el" href="namespacevireo.html#a22f6b18e781e3c412e7d243f7de6aa5c">vireo::ImageFormat</a> for each color attachment</li>
</ul>
<h3>Color blending parameters</h3>
<ul>
<li><code>colorBlendDesc</code> : an array (with the same number of entries as <code>colorRenderFormats</code>) of <a class="el" href="structvireo_1_1ColorBlendDesc.html">vireo::ColorBlendDesc</a> for each color attachment</li>
<li><code>logicOpEnable</code> : controls whether to apply <a class="el" href="namespacevireo.html#a70f67022363c9d48eeade2ca003a5a66">Logical Operations</a>.</li>
<li><code>logicOp</code> : which logical operation to apply.</li>
</ul>
<p>For each value of <code>colorBlendDesc</code> :</p><ul>
<li><code>blendEnable</code> : Controls whether blending is enabled for the corresponding color attachment. If blending is not enabled, the source fragment’s color for that attachment is passed through unmodified.</li>
<li><code>srcColorBlendFactor</code> : Selects which <a class="el" href="namespacevireo.html#a39e43a2b0694d3f59c3ae3b942651d88">blend factor</a> is used to determine the source factors (Sr,Sg,Sb).</li>
<li><code>dstColorBlendFactor</code> : Selects which <a class="el" href="namespacevireo.html#a39e43a2b0694d3f59c3ae3b942651d88">blend factor</a> is used to determine the destination factors (Dr,Dg,Db).</li>
<li><code>colorBlendOp</code> : Selects which <a class="el" href="namespacevireo.html#ab4be653cdc055ecdcaca53e7382883fa">blend operation</a> is used to calculate the RGB values to write to the color attachment.</li>
<li><code>srcAlphaBlendFactor</code> : Selects which <a class="el" href="namespacevireo.html#a39e43a2b0694d3f59c3ae3b942651d88">blend factor</a> is used to determine the source factor Sa.</li>
<li><code>dstAlphaBlendFactor</code> : Selects which <a class="el" href="namespacevireo.html#a39e43a2b0694d3f59c3ae3b942651d88">blend factor</a> is used to determine the destination factor Da.</li>
<li><code>alphaBlendOp</code> : Selects which <a class="el" href="namespacevireo.html#ab4be653cdc055ecdcaca53e7382883fa">blend operation</a> is used to calculate the alpha values to write to the color attachment.</li>
<li><code>colorWriteMask</code> : Is a bitmask specifying which of the <a class="el" href="namespacevireo.html#a6b257efc0b0cd2a722f23dcf0b0519a5">R, G, B, and/or A components</a> are enabled for writing</li>
</ul>
<h3>Multisampling parameters</h3>
<ul>
<li><code>msaa</code> : the <a class="el" href="namespacevireo.html#a10cbf4a39c3f0df11adfce73774f8a5a">number of samples</a> used in rasterization</li>
<li><code>alphaToCoverageEnable</code> : Controls whether a temporary coverage value is generated based on the alpha component of the fragment’s first color output</li>
</ul>
<h3>Rasterization parameters</h3>
<ul>
<li><code>primitiveTopology</code> : the <a class="el" href="namespacevireo.html#a940e3da6a9b57aae3de0b050e2a7af5e">primitive topology</a></li>
<li><code>cullMode</code> : the <a class="el" href="namespacevireo.html#a9602dcbc7b9991767e322a6f55541e8a">triangle facing direction</a> used for primitive culling</li>
<li><code>polygonMode</code> : the <a class="el" href="namespacevireo.html#aa2371b6569c7a782419ffaeb50b97fa7">the triangle rendering mode</a></li>
<li><code>frontFaceCounterClockwise</code>: <code>true</code> if a triangle with positive area is considered front-facing.</li>
</ul>
<h3>Depth testing parameters</h3>
<ul>
<li><code>depthStencilImageFormat</code> : <a class="el" href="namespacevireo.html#a22f6b18e781e3c412e7d243f7de6aa5c">format</a> of the depth and stencil attachment</li>
<li><code>depthTestEnable</code> : controls whether depth testing is enabled.</li>
<li><code>depthWriteEnable</code> : controls whether depth writes are enabled .</li>
<li><code>depthCompareOp</code> : the <a class="el" href="namespacevireo.html#a5b9d3f86075f0f30467dfe025348b3f5">comparison operator</a> to use</li>
<li><code>depthBiasEnable</code> : Controls whether to bias fragment depth values.</li>
<li><code>depthBiasConstantFactor</code> : A scalar factor controlling the constant depth value added to each fragment.</li>
<li><code>depthBiasClamp</code> : The maximum (or minimum) depth bias of a fragment.</li>
<li><code>depthBiasSlopeFactor</code> : A scalar factor applied to a fragment’s slope in depth bias calculations.</li>
</ul>
<h3>Stencil testing parameters</h3>
<ul>
<li><code>stencilTestEnable</code> : Controls whether stencil testing is enabled</li>
<li><code>frontStencilOpState</code> : value controlling the <a class="el" href="structvireo_1_1StencilOpState.html">corresponding parameters</a> of the stencil test.</li>
<li><code>backStencilOpState</code> : value controlling the <a class="el" href="structvireo_1_1StencilOpState.html">corresponding parameters</a> of the stencil test.</li>
</ul>
<p>The stencil reference value is set in the <a class="el" href="manual_100_00_renderpass.html">render pass</a> with <a class="el" href="classvireo_1_1CommandList.html#a0798bbed3923ec01a5a2f88da5107417">vireo::CommandList::setStencilReference</a>.</p>
<h2>Creating a graphic pipeline</h2>
<p>After populating the <a class="el" href="structvireo_1_1GraphicPipelineConfiguration.html">GraphicPipelineConfiguration</a> structure the pipeline creation with <a class="el" href="classvireo_1_1Vireo.html#a4e09ff8f0ade6c4276dcf48e9910466d">vireo::Vireo::createGraphicPipeline</a> is straightforward :</p>
<div class="fragment"><div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The pipeline parameters structure</span></div>
<div class="line">vireo::GraphicPipelineConfiguration pipelineConfig {</div>
<div class="line">    .colorRenderFormats = {<a class="code" href="namespacevireo.html#a22f6b18e781e3c412e7d243f7de6aa5ca5c835c7ea238d0796853827ce416a5e2">vireo::ImageFormat::R8G8B8A8_SRGB</a>},</div>
<div class="line">    .colorBlendDesc     = {{}}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The vertex structure</span></div>
<div class="line"><span class="keyword">struct </span>Vertex {</div>
<div class="line">    glm::vec3 pos;</div>
<div class="line">    glm::vec3 color;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// The vertex structure descriptions</span></div>
<div class="line"><span class="keyword">const</span> std::vector&lt;vireo::VertexAttributeDesc&gt; vertexAttributes{</div>
<div class="line">    {<span class="stringliteral">&quot;POSITION&quot;</span>, <a class="code" href="namespacevireo.html#ae8bee0afbe765c96044673fb0a0f9691ad05d603c5884ae9ccc392513becba305" title="Three signed floats. ">vireo::AttributeFormat::R32G32B32_FLOAT</a>, offsetof(Vertex, pos)},</div>
<div class="line">    {<span class="stringliteral">&quot;COLOR&quot;</span>,    <a class="code" href="namespacevireo.html#ae8bee0afbe765c96044673fb0a0f9691ad05d603c5884ae9ccc392513becba305" title="Three signed floats. ">vireo::AttributeFormat::R32G32B32_FLOAT</a>, offsetof(Vertex, color)}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create the pipeline resources and shader modules</span></div>
<div class="line">pipelineConfig.resources = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createPipelineResources();</div>
<div class="line">pipelineConfig.vertexInputLayout = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createVertexLayout(<span class="keyword">sizeof</span>(Vertex), vertexAttributes);</div>
<div class="line">pipelineConfig.vertexShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/triangle_color.vert&quot;</span>);</div>
<div class="line">pipelineConfig.fragmentShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/triangle_color.frag&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create the pipeline</span></div>
<div class="line">defaultPipeline = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createGraphicPipeline(pipelineConfig);</div>
</div><!-- end fragment -->
<p>Since the <a class="el" href="structvireo_1_1GraphicPipelineConfiguration.html">GraphicPipelineConfiguration</a> structure is only used at creation time, you can use it for multiple pipelines creation :</p>
<div class="fragment"><div class="line"><span class="comment">// Pipeline #1</span></div>
<div class="line">pipelineConfig.colorRenderFormats.push_back(<a class="code" href="namespacevireo.html#a22f6b18e781e3c412e7d243f7de6aa5ca3fa3b9f0bfc91056d90272c3a6e0cbaf">vireo::ImageFormat::R16G16_SFLOAT</a>);</div>
<div class="line">pipelineConfig.resources = resources;</div>
<div class="line">pipelineConfig.fragmentShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/smaa_edge_detect.frag&quot;</span>);</div>
<div class="line">smaaEdgePipeline = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createGraphicPipeline(pipelineConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pipeline #2</span></div>
<div class="line">pipelineConfig.fragmentShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/smaa_blend_weigth.frag&quot;</span>);</div>
<div class="line">smaaBlendWeightPipeline = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createGraphicPipeline(pipelineConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pipeline #3</span></div>
<div class="line">pipelineConfig.colorRenderFormats[0] = renderFormat;</div>
<div class="line">pipelineConfig.resources = smaaResources;</div>
<div class="line">pipelineConfig.fragmentShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/smaa_neighborhood_blend.frag&quot;</span>);</div>
<div class="line">smaaBlendPipeline = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createGraphicPipeline(pipelineConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pipeline #4</span></div>
<div class="line">pipelineConfig.resources = resources;</div>
<div class="line">pipelineConfig.fragmentShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/fxaa.frag&quot;</span>);</div>
<div class="line">fxaaPipeline = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createGraphicPipeline(pipelineConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pipeline #5</span></div>
<div class="line">pipelineConfig.fragmentShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/voronoi.frag&quot;</span>);</div>
<div class="line">effectPipeline = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createGraphicPipeline(pipelineConfig);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pipeline #6</span></div>
<div class="line">pipelineConfig.fragmentShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/gamma_correction.frag&quot;</span>);</div>
<div class="line">gammaCorrectionPipeline = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createGraphicPipeline(pipelineConfig);</div>
</div><!-- end fragment -->
<h2>Drawing</h2>
<p>To execute the shaders, bind the compute pipeline with <a class="el" href="classvireo_1_1CommandList.html#a9d322bc71ab041066fc06899c57f41f6">vireo::CommandList::bindPipeline</a> and its descriptor sets with <a class="el" href="classvireo_1_1CommandList.html#af46655802fb3cbba69de86efa28f84fd">vireo::CommandList::bindDescriptors</a>, then issue draw calls with <a class="el" href="classvireo_1_1CommandList.html#adbf42c05f74289eb98698b991098a9d6">vireo::CommandList::draw</a> or <a class="el" href="classvireo_1_1CommandList.html#aebe6ecf3de6f810b09a9d80dc38bbd8d">vireo::CommandList::drawIndexed</a> :</p>
<div class="fragment"><div class="line"><span class="comment">// Set the descriptor sets list</span></div>
<div class="line">frame.commandList-&gt;setDescriptors({frame.descriptorSet});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Bind the graphic pipeline</span></div>
<div class="line">frame.commandList-&gt;bindPipeline(pipeline);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Bind the descriptor sets</span></div>
<div class="line">frame.commandList-&gt;bindDescriptors(pipeline, {frame.descriptorSet});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw a triangle</span></div>
<div class="line">frame.commandList-&gt;draw(triangleVertices.size());</div>
</div><!-- end fragment -->
<p>If you need to select specific data in the descriptor set you can use <a class="el" href="manual_040_02_descriptor_set.html">dynamic uniform buffer descriptor set</a> :</p>
<div class="fragment"><div class="line">cmdList-&gt;bindDescriptor(pipeline,</div>
<div class="line">    frame.materialsDescriptorSet, SET_MATERIALS,</div>
<div class="line">    frame.materialUniform-&gt;getInstanceSizeAligned() * Scene::MATERIAL_GRID);</div>
<div class="line">cmdList-&gt;bindDescriptor(pipeline,</div>
<div class="line">    frame.modelsDescriptorSet, SET_MODELS,</div>
<div class="line">    frame.modelUniform-&gt;getInstanceSizeAligned() * Scene::MODEL_TRANSPARENT);</div>
<div class="line">scene.drawCube(cmdList);</div>
</div><!-- end fragment -->
<p>Or <a class="el" href="manual_040_03_push_constants.html">push constants</a> : </p><div class="fragment"><div class="line">pushConstants.modelIndex = Scene::MODEL_TRANSPARENT;</div>
<div class="line">pushConstants.materialIndex = Scene::MATERIAL_GRID;</div>
<div class="line">cmdList-&gt;pushConstants(pipelineConfig.resources, pushConstantsDesc, &amp;pushConstants);</div>
<div class="line">scene.drawCube(cmdList);</div>
</div><!-- end fragment -->
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Generated by DoxyPress 2.0.0 -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="manual.html">Manual</a></li><li class="navelem"><a class="el" href="manual_080_00_pipelines.html">Pipelines</a></li>
    <li class="footer">Generated on ven. mai 23 2025 23:06:01 for Vireo &nbsp; by
    <a href="https://www.copperspice.com/documentation-doxypress.html">
    <img class="footer" src="doxypress.png" alt="DoxyPress"/></a> 2.0.0 </li>
  </ul>
</div>
</body>
</html>
