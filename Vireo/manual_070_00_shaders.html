<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="DoxyPress 1.7.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Vireo: Shaders</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxypress.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by DoxyPress -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vireo
      &#160;<span id="projectnumber">0.0</span>
   </div>
   <div id="projectbrief">Vireo 3D Rendering Hardware Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by DoxyPress 1.7.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Documentation</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('manual_070_00_shaders.html',''); initResizable(); });
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
    <div class="title">Shaders </div>
  </div>
  <div class="clear-floats"></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A shader is simply a small program that runs on the GPU to process graphics or compute data. Think of it as an application for GPU.</p>
<h2>Use of shaders</h2>
<p>They are used to transform or generate data in the graphics pipeline (e.g. position, color), or perform general-purpose computation and replaces fixed-function stages with flexible, user-written code.</p>
<p>In a graphic pipeline the following fixed-function stages can be replaced with shaders :</p><ul>
<li>Vertex Shader: runs once per vertex; computes transformed positions, normals, and outputs “vertex data”.</li>
<li>Fragment/Pixel Shader: runs once per pixel (or sample); computes final color, depth, and other per-pixel outputs.</li>
<li>Geometry/Tessellation/Hull/Domain Shaders: (Optional) generate or modify primitives (points, lines, triangles) on the fly.</li>
</ul>
<p>A compute shader is a general-purpose GPU application; not tied to drawing, used for physics, special effects, image filtering, AI, etc.</p>
<h2>Writing shaders</h2>
<p>To write a shader you need the source code written using a shading language that is supported by both DirectX and Vulkan :</p><ul>
<li><a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl">HLSL</a></li>
<li><a href="https://shader-slang.org/">Slang</a></li>
</ul>
<p>Since the main goal of Vireo is to allow the creation of portable 3D application, the <a href="https://shader-slang.org/">Slang shader language</a> is the best solution (moreover Slang is highly derived from HLSL). By using Slang you only have one version of your shaders for both backends.</p>
<p>If you want to discover Slang with real examples, take a look at the <a href="https://github.com/HenriMichelon/vireo_samples">Vireo Samples repository</a>. All the shaders of the samples are written with Slang : vertex, fragment, guffers, lighting, order independent transparency, depth prepass, SMAA, FXAA, ...</p>
<p>Example of a nice wave effect compute shader written in Slang for Vireo : </p><div class="fragment"><div class="line"><span class="keyword">struct </span>Params {</div>
<div class="line">    uint2 imageSize;</div>
<div class="line">    <span class="keywordtype">float</span> time;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">ConstantBuffer&lt;Params&gt; params : <span class="keyword">register</span>(b0);</div>
<div class="line">RWTexture2D outputImage       : <span class="keyword">register</span>(u1);</div>
<div class="line"> </div>
<div class="line">[shader(<span class="stringliteral">&quot;compute&quot;</span>)]</div>
<div class="line">[numthreads(8, 8, 1)]</div>
<div class="line"><span class="keywordtype">void</span> main(uint3 dispatchThreadID : SV_DispatchThreadID) {</div>
<div class="line">    uint2 coord = dispatchThreadID.xy;</div>
<div class="line">    <span class="keywordflow">if</span> (coord.x &gt;= params.imageSize.x || coord.y &gt;=  params.imageSize.y) { <span class="keywordflow">return</span>; }</div>
<div class="line">    float2 uv = float2(coord) / params.imageSize;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> frequency = 20.0;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> amplitude = 0.03;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> bandHeight = 0.05;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> speedX = 0.2;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> speedY = 2.0;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> lightingStrength = 0.75;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> waveAmplitude = amplitude * (0.5 + 0.5 * sin(params.time * speedY)) + amplitude;</div>
<div class="line">    <span class="keywordtype">float</span> wavePhase = (uv.x + params.time * speedX) * frequency;</div>
<div class="line">    <span class="keywordtype">float</span> wave = sin(wavePhase) * waveAmplitude;</div>
<div class="line">    <span class="keywordtype">float</span> slope = cos(wavePhase) * frequency * waveAmplitude;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> waveStripeIndex = int((uv.y + wave) / bandHeight);</div>
<div class="line">    <span class="keywordtype">bool</span> isEvenStripe = (waveStripeIndex % 2) == 0;</div>
<div class="line"> </div>
<div class="line">    float3 color;</div>
<div class="line">    <span class="keywordflow">if</span> (isEvenStripe) {</div>
<div class="line">        float2 uvUp = float2(coord.x, coord.y-1) / params.imageSize;</div>
<div class="line">        float2 uvDown = float2(coord.x, coord.y+1) / params.imageSize;</div>
<div class="line">        <span class="keywordflow">if</span> (coord.y &gt; 0 &amp;&amp; ((<span class="keywordtype">int</span>((uvUp.y + wave) / bandHeight) % 2 != 0) || (<span class="keywordtype">int</span>((uvDown.y + wave) / bandHeight) % 2 != 0))) {</div>
<div class="line">            color = float3(1.0);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            color = float3(uv.x + 0.25, uv.y, .5);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        color = float3(0.0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">float</span> lighting = saturate(1.0 - slope * lightingStrength);</div>
<div class="line">    outputImage[coord] = float4(color * lighting, 1.0);</div>
<div class="line">}</div>
</div><!-- end fragment -->
<p>Note that there is no Vulkan or DirectX specific declaration or instruction in this shader.</p>
<h2>Compiling shaders</h2>
<p>A shader need to be compiled to an intermediate binary format before loading them into a pipeline. The format depends on the graphic API :</p><ul>
<li>For <a class="el" href="namespacevireo.html#ae046059fd4567480e8f03be6171dafd1aeee703cc0a96c14f0661af3ae9420d08">vireo::Backend::DIRECTX</a> : <a href="https://github.com/Microsoft/DirectXShaderCompiler/blob/main/docs/DXIL.rst">DirectX Intermediate Language (DXIL)</a></li>
<li>For <a class="el" href="namespacevireo.html#ae046059fd4567480e8f03be6171dafd1ac60cacb57b9e78f018a9d973bee2f801">vireo::Backend::VULKAN</a> : <a href="https://github.com/KhronosGroup/SPIRV-Guide">SPIR-V</a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd><a href="https://devblogs.microsoft.com/directx/directx-adopting-spir-v/">Once Shader Model 7 is released, DirectX 12 will accept shaders compiled to SPIR-V</a>, suppressing the need for two versions of the binary files for Vireo.</dd></dl>
<p>To compile a Slang shader to both DXIL and SPIR-V intermediate formats the best tool is the Vulkan version of <code>slangc</code> shipped with the <a href="https://vulkan.lunarg.com/sdk/home">Vulkan SDK</a>. Take a look at the <code>cmake/shaders.cmake</code> and <code>CMakeLists.txt</code> files of the <a href="https://github.com/HenriMichelon/vireo_samples">Vireo Samples repository</a> for an example of use with <a href="https://cmake.org/">CMake</a>. This CMake scripts will search for all files with the <code>.slang</code> extension and :</p><ul>
<li>Compile them as compute shader if the file name ends with <code>.comp.slang</code> (entry point <code>main</code>)</li>
<li>Compile them as hull/tesselation control shader if the file name ends with <code>.hull.slang</code> (entry point <code>main</code>)</li>
<li>Compile them as domain//tesselation evaluation shader if the file name ends with <code>.domain.slang</code> (entry point <code>main</code>)</li>
<li>Compile them as geometry shader if the file name ends with <code>.geom.slang</code> (entry point <code>main</code>)</li>
<li>Compile them as vertex shader if the file name ends with <code>.vert.slang</code> (entry point <code>vertexMain</code>)</li>
<li>Compile them as fragment shader if the file name ends with <code>.frag.slang</code> (entry point <code>fragmentMain</code>)</li>
<li>Does nothing if the file name ends with <code>.inc.slang</code></li>
<li>Compile them as vertex and fragment shader for all other files (entry points <code>vertexMain</code> and <code>fragmentMain</code>)</li>
</ul>
<p>This binary formats are called "intermediate" because the drivers needs to translate them to the final binary format with hardware specific instruction sets:</p><ul>
<li>For AMD GPUs : Graphics Core Next (GCN) ISA (also called « AMDGPU ISA »).</li>
<li>For NVidia GPUs : PTX (Parallel Thread Execution, intermediate) and SASS (Streaming ASSembler Shader, low level).</li>
<li>For Intel GPUs : Gen ISA (also called « Intel GPU ISA »).</li>
</ul>
<p>This process can take time and resources, which means that creating a pipeline is a time consuming task : <b>never</b> create pipelines on the fly during rendering, always create all your pipelines during the initialization phase of your application.</p>
<h2>Creating shader modules</h2>
<p>A shader module is a binary compiled version of a shader (like an executable for GPU) that you can load into a pipeline for future execution.</p>
<p>They are created with <a class="el" href="classvireo_1_1Vireo.html#ad525756f14bc5eeacfb8000edcbfa746">vireo::Vireo::createShaderModule</a> : </p><div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> vertexShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/triangle_color.vert&quot;</span>);</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> fragmentShader = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createShaderModule(<span class="stringliteral">&quot;shaders/triangle_color.frag&quot;</span>);</div>
</div><!-- end fragment -->
<p>For maximum portability of the application code the extension of the file is not specified. The <a class="el" href="classvireo_1_1ShaderModule.html">ShaderModule</a> class load the binary file corresponding to the graphic API specified for the <a class="el" href="manual_010_vireo_class.html">vireo object</a> :</p><ul>
<li>For <a class="el" href="namespacevireo.html#ae046059fd4567480e8f03be6171dafd1aeee703cc0a96c14f0661af3ae9420d08">vireo::Backend::DIRECTX</a> it loads the <code>.dxil</code> files</li>
<li>For <a class="el" href="namespacevireo.html#ae046059fd4567480e8f03be6171dafd1ac60cacb57b9e78f018a9d973bee2f801">vireo::Backend::VULKAN</a> it loads the <code>.spv</code> files</li>
</ul>
<p>Once loaded, a shader module can be use with one or more pipeline.</p>
<h2>Using shader modules</h2>
<p>Once loaded into shader modules the shaders are used when <a class="el" href="manual_080_00_pipelines.html">configuring pipelines</a> : </p><div class="fragment"><div class="line">pipelineConfig.vertexShader = vertexShader;</div>
<div class="line">pipelineConfig.fragmentShader = fragmentShader;</div>
</div><!-- end fragment -->
<dl class="section note"><dt>Note</dt><dd>A pipeline is tied to the configured shader modules, which means that you need one pipeline for each set of shaders.</dd></dl>
<h2>Binding resources with shader variables</h2>
<p>To use a <a class="el" href="manual_030_00_resources.html">resource</a> in a shader you need to :</p><ul>
<li><a class="el" href="manual_040_00_descriptors.html">bind them to the pipeline</a> using <a class="el" href="manual_040_02_descriptor_set.html">descriptor sets</a></li>
<li>Reference them in your shader using the same binding and set/space numbers.</li>
</ul>
<p>When using the Slang shader language you can use the HLSL register syntax to reference resource by binding numbers and set/space number.</p>
<p>For example, if you have a <a class="el" href="manual_040_02_descriptor_set.html">descriptor set</a> configured described by this <a class="el" href="manual_040_01_descriptor_layout.html">descriptor layout</a> and structures:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Global {</div>
<div class="line">    <span class="keyword">alignas</span>(16) glm::vec3 cameraPosition{0.0f, 0.0f, 1.75f};</div>
<div class="line">    <span class="keyword">alignas</span>(16) glm::mat4 projection;</div>
<div class="line">    glm::mat4 view;</div>
<div class="line">    glm::mat4 viewInverse;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Light {</div>
<div class="line">    <span class="keyword">alignas</span>(16) glm::vec3 direction{1.0f, -.25f, -.5f};</div>
<div class="line">    <span class="keyword">alignas</span>(16) glm::vec4 color{1.0f, 1.0f, 1.0f, 1.0f};</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">static <span class="keyword">constexpr</span> <a class="code" href="namespacevireo.html#a0e0fd186e31841264c06580c22ffe6c2">vireo::DescriptorIndex</a> SET_GLOBAL{0};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code" href="namespacevireo.html#a0e0fd186e31841264c06580c22ffe6c2">vireo::DescriptorIndex</a> BINDING_GLOBAL{0};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code" href="namespacevireo.html#a0e0fd186e31841264c06580c22ffe6c2">vireo::DescriptorIndex</a> BINDING_LIGHT{1};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code" href="namespacevireo.html#a0e0fd186e31841264c06580c22ffe6c2">vireo::DescriptorIndex</a> BINDING_TEXTURES{2};</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">descriptorLayout = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createDescriptorLayout();</div>
<div class="line">descriptorLayout-&gt;add(BINDING_GLOBAL, <a class="code" href="namespacevireo.html#adf8e136713c0691010d2bec6ba63e9cfa891f35a29c3d51d02ffd42dd6dcc69b2" title="Used for shader uniform (in host visible memory) ">vireo::DescriptorType::UNIFORM</a>);</div>
<div class="line">descriptorLayout-&gt;add(BINDING_LIGHT, <a class="code" href="namespacevireo.html#adf8e136713c0691010d2bec6ba63e9cfa891f35a29c3d51d02ffd42dd6dcc69b2" title="Used for shader uniform (in host visible memory) ">vireo::DescriptorType::UNIFORM</a>);</div>
<div class="line">descriptorLayout-&gt;add(BINDING_TEXTURES, <a class="code" href="namespacevireo.html#a684e147d500221ad811a1b6b4f2c5117a5962997ee79a425d6e827f89fc2ced78" title="Sampled texture (image only, no sampler) ">vireo::DescriptorType::SAMPLED_IMAGE</a>, scene.getTextures().size());</div>
<div class="line">descriptorLayout-&gt;build();</div>
</div><!-- end fragment -->
<p>During initialization create the descriptor set using this layout and attach the <a class="el" href="manual_030_00_resources.html">resources</a> : </p><div class="fragment"><div class="line">frame.descriptorSet = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createDescriptorSet(descriptorLayout);</div>
<div class="line">frame.descriptorSet-&gt;update(BINDING_GLOBAL, frame.globalUniform);</div>
<div class="line">frame.descriptorSet-&gt;update(BINDING_LIGHT, frame.lightUniform);</div>
<div class="line">frame.descriptorSet-&gt;update(BINDING_TEXTURES, scene.getTextures());</div>
</div><!-- end fragment -->
<p>And during rendering update the data in VRAM then bind the resources before drawing : </p><div class="fragment"><div class="line">frame.globalUniform-&gt;write(&amp;scene.getGlobal());</div>
<div class="line">frame.lightUniform-&gt;write(&amp;light);</div>
<div class="line">frameCommandList-&gt;bindDescriptor(pipeline, frame.descriptorSet, SET_GLOBAL);</div>
</div><!-- end fragment -->
<p>You can reference the corresponding resources in the shader like that using the same <code>SET_*</code> (<code>space*</code>) and <code>BINDING_*</code> values : </p><div class="fragment"><div class="line"><span class="keyword">struct </span>Global {</div>
<div class="line">    float3   cameraPosition;</div>
<div class="line">    float4x4 projection;</div>
<div class="line">    float4x4 view;</div>
<div class="line">    float4x4 viewInverse;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Light {</div>
<div class="line">    float3 direction;</div>
<div class="line">    float4 color;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">ConstantBuffer&lt;Global&gt; global      : <span class="keyword">register</span>(b0, space0);</div>
<div class="line">ConstantBuffer&lt;Light&gt;  light       : <span class="keyword">register</span>(b1, space0);</div>
<div class="line">Texture2D              textures[5] : <span class="keyword">register</span>(t2, space0);</div>
</div><!-- end fragment -->
<p>The <code>slangc</code> tool will translate the register syntax to a SPIR-V compatible code for you. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Generated by DoxyPress 1.7.0 -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="manual.html">Manual</a></li>
    <li class="footer">Generated on lun. mai 12 2025 15:13:57 for Vireo &nbsp; by
    <a href="https://www.copperspice.com/documentation-doxypress.html">
    <img class="footer" src="doxypress.png" alt="DoxyPress"/></a> 1.7.0 </li>
  </ul>
</div>
</body>
</html>
