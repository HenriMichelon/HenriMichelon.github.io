<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="DoxyPress 2.0.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Vireo: Vertex data</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxypress.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by DoxyPress -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vireo
      &#160;<span id="projectnumber">0.0</span>
   </div>
   <div id="projectbrief">Vireo 3D Rendering Hardware Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by DoxyPress 2.0.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Documentation</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tutorial_1_09_vertex_data.html',''); initResizable(); });
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
    <div class="title">Vertex data </div>
  </div>
  <div class="clear-floats"></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Our triangle vertices will be hard-coded into the application. Add the struct describing a vertex composed of a XYZ position and an RGB color in your class interface:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Vertex {</div>
<div class="line">    glm::vec3 pos;</div>
<div class="line">    glm::vec3 color;</div>
<div class="line">};</div>
</div><!-- end fragment -->
<p>Add the triangle data with a different color for each vertex, after the <code>Vertex</code> struct:</p>
<div class="fragment"><div class="line">std::vector&lt;Vertex&gt; triangleVertices{</div>
<div class="line">    { {  0.0f,  0.5f, 0.0f }, { 1.0f, 0.0f, 0.0f } },</div>
<div class="line">    { {  0.5f, -0.5f, 0.0f }, { 0.0f, 1.0f, 0.0f } },</div>
<div class="line">    { { -0.5f, -0.5f, 0.0f }, { 0.0f, 0.0f, 1.0f } }</div>
<div class="line">};</div>
</div><!-- end fragment -->
<p>The next step is to tell the graphic API how to pass this data format to the vertex shader once it's been uploaded into GPU memory. We have to describe each field of the <code>Vertex</code> struct using <a class="el" href="structvireo_1_1VertexAttributeDesc.html">VertexAttributeDesc</a>, after the triangle data:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> std::vector&lt;vireo::VertexAttributeDesc&gt; vertexAttributes{</div>
<div class="line">    {<span class="stringliteral">&quot;POSITION&quot;</span>, <a class="code" href="namespacevireo.html#ae8bee0afbe765c96044673fb0a0f9691ad05d603c5884ae9ccc392513becba305" title="Three signed floats. ">vireo::AttributeFormat::R32G32B32_FLOAT</a>, offsetof(Vertex, pos)},</div>
<div class="line">    {<span class="stringliteral">&quot;COLOR&quot;</span>,    <a class="code" href="namespacevireo.html#ae8bee0afbe765c96044673fb0a0f9691ad05d603c5884ae9ccc392513becba305" title="Three signed floats. ">vireo::AttributeFormat::R32G32B32_FLOAT</a>, offsetof(Vertex, color)}</div>
<div class="line">};</div>
</div><!-- end fragment -->
<p>This vector is used to create the vertex layout for the future pipeline. Add the following code before the for loop in the <code>onInit()</code> method:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> vertexLayout = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createVertexLayout(<span class="keyword">sizeof</span>(Vertex), vertexAttributes);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; frameData : framesData) {</div>
</div><!-- end fragment -->
<p>We are done with the vertex layout. Now we have to upload the vertex data into the VRAM in a <a class="el" href="namespacevireo.html#adf8e136713c0691010d2bec6ba63e9cfa0c3e47aef93a7f244f41ab309a33634b">vireo::BufferType::VERTEX</a> buffer. Add the buffer field to your application :</p>
<div class="fragment"><div class="line">std::shared_ptr&lt;vireo::Buffer&gt; vertexBuffer;</div>
</div><!-- end fragment -->
<p>In the <code>onInit()</code> method, just before the <code>createVertexLayout()</code> line, add the buffer creation :</p>
<div class="fragment"><div class="line">vertexBuffer = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createBuffer(</div>
<div class="line">   <a class="code" href="namespacevireo.html#adf8e136713c0691010d2bec6ba63e9cfa0c3e47aef93a7f244f41ab309a33634b" title="Used to store vertices (in GPU memory) ">vireo::BufferType::VERTEX</a>,</div>
<div class="line">   <span class="keyword">sizeof</span>(Vertex),</div>
<div class="line">   triangleVertices.size());</div>
</div><!-- end fragment -->
<p>We will use a <a class="el" href="namespacevireo.html#a21e038f5b8958e203d28bc4f18472352aeb5ddb3b6096fb90ff720d9c3e2a6628">vireo::CommandType::TRANSFER</a> command list to upload the vertex data into the VRAM. You can use a <a class="el" href="namespacevireo.html#a21e038f5b8958e203d28bc4f18472352a930d8d2d00ae0f554c96edc5739801e1">vireo::CommandType::GRAPHIC</a> command list for that but the <a class="el" href="namespacevireo.html#a21e038f5b8958e203d28bc4f18472352aeb5ddb3b6096fb90ff720d9c3e2a6628">vireo::CommandType::TRANSFER</a> command buffers and submit queues can take advantage of DMA transfers.</p>
<p>In the <code>onInit()</code> method, just after the buffer creation add the command allocator and command list creation :</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> uploadCommandAllocator = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createCommandAllocator(<a class="code" href="namespacevireo.html#a21e038f5b8958e203d28bc4f18472352aeb5ddb3b6096fb90ff720d9c3e2a6628" title="Command/Queue for copy operations. ">vireo::CommandType::TRANSFER</a>);</div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> uploadCommandList = uploadCommandAllocator-&gt;createCommandList();</div>
</div><!-- end fragment -->
<p>Followed by the recording of the upload command :</p>
<div class="fragment"><div class="line">uploadCommandList-&gt;begin();</div>
<div class="line">uploadCommandList-&gt;upload(vertexBuffer, &amp;triangleVertices[0]);</div>
<div class="line">uploadCommandList-&gt;end();</div>
</div><!-- end fragment -->
<p>Then the submission of the commands using a <a class="el" href="namespacevireo.html#a21e038f5b8958e203d28bc4f18472352aeb5ddb3b6096fb90ff720d9c3e2a6628">vireo::CommandType::TRANSFER</a> submit queue :</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> transferQueue = <a class="code" href="namespacevireo.html">vireo</a>-&gt;createSubmitQueue(<a class="code" href="namespacevireo.html#a21e038f5b8958e203d28bc4f18472352aeb5ddb3b6096fb90ff720d9c3e2a6628" title="Command/Queue for copy operations. ">vireo::CommandType::TRANSFER</a>);</div>
<div class="line">transferQueue-&gt;submit({uploadCommandList});</div>
</div><!-- end fragment -->
<p>Since the upload operation is asynchronous, we have to wait for the command to finish before terminating the <code>onInit()</code> method. Add the following code at the end of the method :</p>
<div class="fragment"><div class="line">transferQueue-&gt;waitIdle();</div>
<div class="line">uploadCommandList-&gt;cleanup();</div>
</div><!-- end fragment -->
<p>By adding the <a class="el" href="classvireo_1_1SubmitQueue.html#a899a95c062c476e0f4616683c81a77d0">vireo::SubmitQueue::waitIdle</a> at the end of the method, the upload operation will be executed while we continue to create our pipeline.</p>
<p>Note that we call the <a class="el" href="classvireo_1_1CommandList.html#acbb28cf8bdd606e0131fc72218504abc">vireo::CommandList::cleanup</a> method to clear the temporary (staging) buffer used for the host-to-device copy of the vertex data. The asynchronous nature of the operation means that we have to wait for the end of the operation to free the host-visible allocated memory. This is done automatically in the command list destructor, but we added this call in the tutorial for clarification.</p>
<p>Next : <a class="el" href="tutorial_1_10_pipeline.html">The graphic pipeline</a></p>
<hr/>
<p> Related manual page : <a class="el" href="manual_030_01_resources.html">Memory buffers</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Generated by DoxyPress 2.0.0 -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="getting_started.html">Getting Started</a></li><li class="navelem"><a class="el" href="gs_020_tutorial_1.html">&quot;Hello Triangle&quot; tutorial</a></li>
    <li class="footer">Generated on ven. mai 23 2025 23:06:01 for Vireo &nbsp; by
    <a href="https://www.copperspice.com/documentation-doxypress.html">
    <img class="footer" src="doxypress.png" alt="DoxyPress"/></a> 2.0.0 </li>
  </ul>
</div>
</body>
</html>
