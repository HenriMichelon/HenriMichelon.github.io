<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="DoxyPress 1.7.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Vireo: Memory barriers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxypress.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by DoxyPress -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vireo
      &#160;<span id="projectnumber">0.0</span>
   </div>
   <div id="projectbrief">Vireo 3D Rendering Hardware Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by DoxyPress 1.7.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Documentation</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('manual_090_03_barriers.html',''); initResizable(); });
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
    <div class="title">Memory barriers </div>
  </div>
  <div class="clear-floats"></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A memory barrier is a GPU/GPU synchronization mechanism. They are use <b>inside</b> <a class="el" href="manual_100_00_renderpass.html">render passes</a> : barriers enforce execution and memory ordering within or across <a class="el" href="manual_050_00_commands.html">command lists</a>.</p>
<p>They prevent hazards like read-after-write, write-after-read, etc., by ensuring visibility and availability of resource modifications and prepare the resource to be in an optimized layout for the next task.</p>
<p>A barrier in recorded in a command list with <a class="el" href="classvireo_1_1CommandList.html#aa97d0ab80ed8a2d96e328ba6c70fa05f">vireo::CommandList::barrier</a> with the resource, the source state and the destination state. For Vulkan the barrier methods will take care of the correct pipeline stages and layouts for you (for DirectX 12 it's the driver) :</p>
<div class="fragment"><div class="line"><span class="comment">// Wait for all the data of the graphic rendering pass to be written in the color attachment</span></div>
<div class="line"><span class="comment">// before copying the image</span></div>
<div class="line">commandList-&gt;barrier(</div>
<div class="line">    colorBuffer,</div>
<div class="line">    <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705a37861cf9cb0fdd450e8ba039e6841745" title="Used as a color attachment in the graphics pipeline. ">vireo::ResourceState::RENDER_TARGET_COLOR</a>,</div>
<div class="line">    <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705a418a992d8e0a8e89c5cf2c49d6e340ba" title="Used as a source image of a transfer/copy/blit command. ">vireo::ResourceState::COPY_SRC</a>);</div>
</div><!-- end fragment -->
<p>In an application the barriers states <b>must</b> be perfect : with DirectX 12 you <b>can't</b> use an source state different from the current state of the resource. This can lead to a lot of barriers :</p>
<div class="fragment"><div class="line">commandList-&gt;barrier(</div>
<div class="line">    depthPrepass.getDepthBuffer(frameIndex),</div>
<div class="line">    depthPrepass.isWithStencil() ?</div>
<div class="line">            <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705a9a4001ca6a21e7dd35e801912ee9e773" title="Used as a depth and stencil attachment in the graphics pipeline. ">vireo::ResourceState::RENDER_TARGET_DEPTH_STENCIL</a> :</div>
<div class="line">            <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705a9df4ba778104d8c35b474fe84fb45431" title="Used as a depth attachment in the graphics pipeline. ">vireo::ResourceState::RENDER_TARGET_DEPTH</a>,</div>
<div class="line">    <a class="code" href="namespacevireo.html#ae046059fd4567480e8f03be6171dafd1a0db45d2a4141101bdfe48e3314cfbca3" title="Not used. ">vireo::ResourceState::UNDEFINED</a>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> colorBuffer = postProcessing.getColorBuffer(frameIndex);</div>
<div class="line"><span class="keywordflow">if</span> (colorBuffer == <span class="keyword">nullptr</span>) {</div>
<div class="line">    colorBuffer = frame.colorBuffer;</div>
<div class="line">}</div>
<div class="line">commandList-&gt;barrier(</div>
<div class="line">    swapChain,</div>
<div class="line">    <a class="code" href="namespacevireo.html#ae046059fd4567480e8f03be6171dafd1a0db45d2a4141101bdfe48e3314cfbca3" title="Not used. ">vireo::ResourceState::UNDEFINED</a>,</div>
<div class="line">    <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705aba1c00f34d04b40f9e1eddd20de122de" title="Used as a destination image of a transfer/copy/blit command. ">vireo::ResourceState::COPY_DST</a>);</div>
<div class="line">commandList-&gt;barrier(</div>
<div class="line">    colorBuffer,</div>
<div class="line">    <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705a37861cf9cb0fdd450e8ba039e6841745" title="Used as a color attachment in the graphics pipeline. ">vireo::ResourceState::RENDER_TARGET_COLOR</a>,</div>
<div class="line">    <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705a418a992d8e0a8e89c5cf2c49d6e340ba" title="Used as a source image of a transfer/copy/blit command. ">vireo::ResourceState::COPY_SRC</a>);</div>
<div class="line">commandList-&gt;copy(colorBuffer, swapChain);</div>
<div class="line">commandList-&gt;barrier(</div>
<div class="line">    colorBuffer,</div>
<div class="line">    <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705a418a992d8e0a8e89c5cf2c49d6e340ba" title="Used as a source image of a transfer/copy/blit command. ">vireo::ResourceState::COPY_SRC</a>,</div>
<div class="line">    <a class="code" href="namespacevireo.html#ae046059fd4567480e8f03be6171dafd1a0db45d2a4141101bdfe48e3314cfbca3" title="Not used. ">vireo::ResourceState::UNDEFINED</a>);</div>
<div class="line">commandList-&gt;barrier(</div>
<div class="line">    swapChain,</div>
<div class="line">    <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705aba1c00f34d04b40f9e1eddd20de122de" title="Used as a destination image of a transfer/copy/blit command. ">vireo::ResourceState::COPY_DST</a>,</div>
<div class="line">    <a class="code" href="namespacevireo.html#a33ee7da93cb9c170c97d8e60f3187705a720ff3fec5d13dcf3d3aec6d5726fc36" title="Used for presenting a presentable image for display. ">vireo::ResourceState::PRESENT</a>);</div>
<div class="line">commandList-&gt;end();</div>
</div><!-- end fragment -->
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Generated by DoxyPress 1.7.0 -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="manual.html">Manual</a></li><li class="navelem"><a class="el" href="manual_090_00_synchronization.html">Synchronization</a></li>
    <li class="footer">Generated on lun. mai 12 2025 15:13:57 for Vireo &nbsp; by
    <a href="https://www.copperspice.com/documentation-doxypress.html">
    <img class="footer" src="doxypress.png" alt="DoxyPress"/></a> 1.7.0 </li>
  </ul>
</div>
</body>
</html>
